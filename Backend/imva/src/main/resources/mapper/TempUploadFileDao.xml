<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lazysun.imva.dao.TempUploadFileDao">

    <select id="findUploadIdByMD5" resultType="java.lang.String">
        SELECT upload_id FROM temp_upload_file WHERE user_id = #{userId} AND md5 = #{md5} AND enable = 0
    </select>


    <insert id="insertOverlay">
        INSERT INTO temp_upload_file (upload_id, md5, user_id, file_name, enable)
        VALUES (#{uploadId}, #{md5}, #{userId}, #{fileName}, 0)
        ON DUPLICATE KEY UPDATE upload_id = #{uploadId} , file_name = #{fileName}
    </insert>


    <select id="getFileNameByUploadId" resultType="java.lang.String">
        SELECT file_name FROM temp_upload_file WHERE upload_id = #{uploadId} AND enable = 0
    </select>


    <update id="deleteByUploadId">
        UPDATE temp_upload_file SET enable = id WHERE upload_id = #{uploadId}
    </update>


    <select id="getFileNameByMD5" resultType="java.lang.String">
        SELECT file_name FROM temp_upload_file WHERE user_id = #{userId} AND md5 = #{md5}
    </select>
</mapper>